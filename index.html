<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Age Calculator | आयु कैलकुलेटर</title>
  <link rel="stylesheet" href="style.css">
  <meta name="color-scheme" content="light dark" />

</head>
<body>
  <div class="app" role="application" aria-labelledby="app-title">
    <header>
      <div class="title">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1 id="app-title">Age Calculator • आयु कैलकुलेटर</h1>
          <p class="sub">Enter Date of Birth → सटीक उम्र सेकंडों में</p>
        </div>
      </div>
      <div class="actions">
        <button id="shareBtn" title="Share current DOB link">Share</button>
        <button id="resetBtn" title="Clear input">Reset</button>
      </div>
    </header>

    <main>
      <div class="grid" id="form">
        <div>
          <label for="dob">जन्म तिथि / Date of Birth</label>
          <input type="date" id="dob" name="dob" required />
          <div class="help">Past date only. The calculation uses your local calendar.</div>
          <div id="err" class="error" role="alert">कृपया वैध पिछली तारीख चुनें।</div>
        </div>
        <button id="calcBtn" class="primary">Calculate</button>
        <button id="todayBtn">Use Today</button>
      </div>

      <section id="out" class="sr-only" aria-live="polite">
        Results will appear here
      </section>

      <div id="resultWrap" style="margin-top:18px; display:none">
        <div class="result">
          <div class="stat">
            <h3>Years</h3>
            <div id="years" class="value">—</div>
            <div class="muted">पूरा किए गए वर्ष</div>
          </div>
          <div class="stat">
            <h3>Months</h3>
            <div id="months" class="value">—</div>
            <div class="muted">अतिरिक्त महीने</div>
          </div>
          <div class="stat">
            <h3>Days</h3>
            <div id="days" class="value">—</div>
            <div class="muted">अतिरिक्त दिन</div>
          </div>
        </div>

        <div class="details" id="more">
          <div><strong>Exact age:</strong> <span id="exact">—</span></div>
          <div class="badges">
            <span class="badge">Total days: <span id="totalDays">—</span></span>
            <span class="badge">Weeks: <span id="weeks">—</span></span>
            <span class="badge">Next birthday in: <span id="next">—</span></span>
          </div>
        </div>
      </div>
    </main>

    <footer>
      <!-- <div class="muted">Made with vanilla JS. Handles leap years and month lengths accurately.</div>
      <div> -->
        <button id="copyAgeBtn">Copy age</button>
      </div>
    </footer>
  </div>

  <script src="script.js"></script>

  <script>
    // Utilities
    const $ = s => document.querySelector(s);

    function todayYMD(){
      const d = new Date();
      return { y: d.getFullYear(), m: d.getMonth()+1, d: d.getDate() };
    }
    function daysInMonth(y, m){ // m: 1-12
      return new Date(y, m, 0).getDate();
    }
    function parseYMD(value){
      // value: "YYYY-MM-DD"
      const [y,m,d] = value.split('-').map(Number);
      return { y, m, d };
    }
    function validPastDate(ymd){
      if(!ymd || !ymd.y || !ymd.m || !ymd.d) return false;
      const t = todayYMD();
      // Construct local dates (no time) to compare
      const a = new Date(ymd.y, ymd.m-1, ymd.d, 12);
      const b = new Date(t.y, t.m-1, t.d, 12);
      return a.getTime() <= b.getTime() && ymd.y > 0;
    }
    function diffYMD(from, to){
      // Returns exact difference in calendar years, months, days
      // from: DOB, to: today; both {y,m,d}
      let y = to.y - from.y;
      let m = to.m - from.m;
      let d = to.d - from.d;

      if(d < 0){
        // borrow days from previous month
        const prevMonth = ((to.m + 10) % 12) + 1; // month before 'to.m'
        const prevYear = prevMonth === 12 ? to.y - 1 : to.y;
        d += daysInMonth(prevYear, prevMonth);
        m -= 1;
      }
      if(m < 0){
        m += 12;
        y -= 1;
      }
      if(y < 0){
        return { y: 0, m: 0, d: 0 };
      }
      return { y, m, d };
    }
    function totalDaysBetween(from, to){
      const a = new Date(from.y, from.m-1, from.d, 12);
      const b = new Date(to.y, to.m-1, to.d, 12);
      const ms = b - a;
      return Math.floor(ms / 86400000);
    }
    function nextBirthday(from, to){
      let year = to.y;
      // Handle Feb 29 birthdays: next valid date in non-leap years is Feb 28 by convention
      const isFeb29 = (from.m === 2 && from.d === 29);
      const targetDay = isFeb29 && daysInMonth(year,2) === 28 ? 28 : from.d;

      let next = { y: year, m: from.m, d: targetDay };
      const hasOccurred = (to.m > next.m) || (to.m === next.m && to.d >= next.d);
      if(hasOccurred){
        year += 1;
        const day2 = isFeb29 && daysInMonth(year,2) === 28 ? 28 : from.d;
        next = { y: year, m: from.m, d: day2 };
      }
      const daysLeft = totalDaysBetween(to, next);
      // Also express as months/days approx
      const approxMonths = Math.floor(daysLeft / 30.4375);
      const remDays = Math.max(0, Math.round(daysLeft - approxMonths * 30.4375));
      return { daysLeft, approx: `${approxMonths} mo ${remDays} d` };
    }
    function fmt(n){ return n.toLocaleString(undefined); }

    // DOM Wiring
    const dobInput = $('#dob');
    const err = $('#err');
    const calcBtn = $('#calcBtn');
    const todayBtn = $('#todayBtn');
    const shareBtn = $('#shareBtn');
    const resetBtn = $('#resetBtn');
    const resultWrap = $('#resultWrap');
    const outLive = $('#out');
    const yearsEl = $('#years');
    const monthsEl = $('#months');
    const daysEl = $('#days');
    const exactEl = $('#exact');
    const totalDaysEl = $('#totalDays');
    const weeksEl = $('#weeks');
    const nextEl = $('#next');
    const copyAgeBtn = $('#copyAgeBtn');

    function setMaxDate(){
      const t = todayYMD();
      const mm = String(t.m).padStart(2,'0');
      const dd = String(t.d).padStart(2,'0');
      dobInput.max = `${t.y}-${mm}-${dd}`;
    }

    function render(){
      const val = dobInput.value;
      if(!val){ showError(false); return; }
      const dob = parseYMD(val);
      if(!validPastDate(dob)){ showError(true); return; }

      const t = todayYMD();
      const d = diffYMD(dob, t);
      const totalD = totalDaysBetween(dob, t);
      const w = Math.floor(totalD / 7);
      const nxt = nextBirthday(dob, t);

      yearsEl.textContent = d.y;
      monthsEl.textContent = d.m;
      daysEl.textContent = d.d;
      exactEl.textContent = `${d.y} years, ${d.m} months, ${d.d} days`;
      totalDaysEl.textContent = fmt(totalD);
      weeksEl.textContent = fmt(w);
      nextEl.textContent = `${fmt(nxt.daysLeft)} days (~${nxt.approx})`;

      resultWrap.style.display = 'block';
      outLive.classList.remove('sr-only');
      outLive.textContent = `Age: ${d.y} years, ${d.m} months, ${d.d} days.`;
      showError(false);
      persist(val);
      updateURL(val);
    }

    function showError(show){
      err.style.display = show ? 'block' : 'none';
      if(show){
        resultWrap.style.display = 'none';
        outLive.textContent = 'Invalid date.';
      }
    }

    function useToday(){
      const t = todayYMD();
      const mm = String(t.m).padStart(2,'0');
      const dd = String(t.d).padStart(2,'0');
      dobInput.value = `${t.y}-${mm}-${dd}`;
      render();
    }

    function updateURL(val){
      const url = new URL(location.href);
      url.searchParams.set('dob', val);
      history.replaceState(null, '', url);
    }
    function persist(val){
      try{ localStorage.setItem('agecalc_dob', val); }catch{}
    }
    function restore(){
      const urlDob = new URL(location.href).searchParams.get('dob');
      const saved = (()=>{ try{ return localStorage.getItem('agecalc_dob'); }catch{} return null; })();
      const v = urlDob || saved;
      if(v){
        dobInput.value = v;
        render();
      }
    }

    // Share current link with DOB param
    async function shareLink(){
      const val = dobInput.value;
      if(!val) return;
      const url = new URL(location.href);
      url.searchParams.set('dob', val);
      const link = url.toString();
      try{
        if(navigator.share){
          await navigator.share({ title: 'Age Calculator', text: 'Check this DOB:', url: link });
        }else{
          await navigator.clipboard.writeText(link);
          shareBtn.textContent = 'Link Copied';
          setTimeout(()=> shareBtn.textContent='Share', 1400);
        }
      }catch{
        await navigator.clipboard.writeText(link);
      }
    }

    // Copy plain-text age summary
    async function copyAge(){
      const y = yearsEl.textContent;
      if(!y || y === '—') return;
      const txt = `Age: ${yearsEl.textContent} years, ${monthsEl.textContent} months, ${daysEl.textContent} days\n` +
                  `Total days: ${totalDaysEl.textContent}\n` +
                  `Weeks: ${weeksEl.textContent}\n` +
                  `Next birthday in: ${nextEl.textContent}`;
      try{
        await navigator.clipboard.writeText(txt);
        copyAgeBtn.textContent = 'Copied';
        setTimeout(()=> copyAgeBtn.textContent='Copy age', 1200);
      }catch{}
    }

    // Events
    calcBtn.addEventListener('click', render);
    todayBtn.addEventListener('click', useToday);
    dobInput.addEventListener('change', render);
    shareBtn.addEventListener('click', shareLink);
    resetBtn.addEventListener('click', ()=>{
      dobInput.value = '';
      resultWrap.style.display='none';
      showError(false);
      outLive.textContent = 'Results will appear here';
      updateURL('');
    });
    copyAgeBtn.addEventListener('click', copyAge);

    // Init
    setMaxDate();
    restore();
  </script>
</body>
</html>
